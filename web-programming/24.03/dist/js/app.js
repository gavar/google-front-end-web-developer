!function(t){var e={};function s(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,r){s.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},s.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e){const s=["anchor","bicycle","bolt","bomb","cube","diamond","leaf","paper-plane-o"];class r extends EventTarget{constructor(t){super(),this.props=Object.assign({},t),this.repaint=this.repaint.bind(this),this.state=this.initialState(),this.componentWillMount(this.props,this.state),this.render(this.props,this.state),this.componentDidMount(this.props,this.state)}setState(t){const e=this.state,s=this.props;"function"==typeof t&&(t=t(e,s)||e),Object.assign(this.state,t),this.dirty||(this.dirty=!0,setTimeout(this.repaint,0))}componentWillMount(t,e){}componentDidMount(t,e){}initialState(){return{}}repaint(){this.dirty=!1,this.render(this.props,this.state)}}const n={moves:0,stars:3},a=!1,o=new Event("game-over"),i="correct",c="incorrect",l="selection",d=["open","show","match","wrong"];new class extends r{constructor(t){super(t),t.game.addEventListener("game-over",this.onGameOver.bind(this)),t.restart.addEventListener("click",this.onPlayAgainClick.bind(this))}render(t,e){switch(t.moves.innerText=n.moves.toString(),t.stars.innerText=n.stars.toString(),e.visible){case!0:t.view.classList.add("show");break;case!1:t.view.classList.remove("show")}}initialState(){return{visible:void 0}}onGameOver(){this.setState({visible:!0})}onPlayAgainClick(){this.setState((t,e)=>(t.visible=!1,e.game.restart(),t))}}({game:new class extends r{constructor(t){super(t),this.delay=1e3,t.deck.addEventListener("click",this.onDeckClick.bind(this)),t.restart.addEventListener("click",this.onRestartClick.bind(this))}render(t,e){t.deck.style.display=e.visible?null:"none",t.moves.innerText=n.moves.toString();for(const t of e.cards)switch(t.status){case i:t.element.classList.add("show","match");break;case l:t.element.classList.add("show","open");break;case c:t.element.classList.add("show","open","wrong");break;default:t.element.classList.remove.apply(t.element.classList,d)}for(;e.stars.length>n.stars;)e.stars.pop().remove()}restart(){n.moves=0,n.stars=3,this.setState((t,e)=>{const r=this.initialState();for(const e of t.cards)e.element.remove();for(let t=0;t<s.length;t++){const e=document.createElement("li");e.classList.add("card");const n=document.createElement("i");n.classList.add("fa",`fa-${s[t]}`),e.appendChild(n),r.cards.push({shows:0,element:e},{shows:0,element:e.cloneNode(!0)})}for(const e of t.stars)e.remove();for(let t=0;t<n.stars;t++){const t=document.createElement("li"),e=document.createElement("i");e.classList.add("fa","fa-star"),t.appendChild(e),r.stars.push(t)}if(a)for(let t=r.cards.length-3;t>=0;t--)r.cards[t].status=i;!function(t){let e,s;for(let r=t.length-1;r>=0;r--)s=Math.floor(Math.random()*r),e=t[r],t[r]=t[s],t[s]=e}(r.cards);{const t=document.createDocumentFragment();for(const e of r.cards)t.appendChild(e.element);e.deck.appendChild(t)}{const t=document.createDocumentFragment();for(const e of r.stars)t.appendChild(e);e.stars.appendChild(t)}return r})}componentWillMount(){this.restart()}initialState(){return{visible:!0,mistakes:0,stars:[],cards:[]}}isGameOver(t){return this.countOf(t.cards,i)===t.cards.length}cardOf(t,e){for(const s of t)if(s.element===e)return s}countOf(t,e){let s=0;for(let r=0;r<t.length;r++)t[r].status===e&&s++;return s}setStatusOf(t,e){this.setState(s=>{for(const r of s.cards)r.status===t&&(r.status=e);return s})}setStatusOfSelections(t){this.setStatusOf(l,t)}onSelectListElement(t){this.setState(e=>{const s=this.cardOf(e.cards,t);switch(s.status){case l:case i:return}if(this.countOf(e.cards,l)>1)return;s.status=l,s.shows++;const r=[];for(let t=0;t<e.cards.length;t++)e.cards[t].status==l&&r.push(t);return r.length>1&&(n.moves++,this.hasMatch(e,r)?this.onSucessfulMatch(r):this.onMatchFailure(r)),e})}hasMatch(t,e){if(e.length<1)return!1;const s=t.cards[e[0]].element.firstElementChild;for(let r=1;r<e.length;r++){const n=t.cards[e[r]].element.firstElementChild;if(s.className!=n.className)return!1}return!0}onSucessfulMatch(t){this.setState(e=>{for(const s of t)e.cards[s].status=i;this.isGameOver(e)&&this.dispatchEvent(o)})}onMatchFailure(t){this.setState(e=>{let s=!1;for(const r of t){const t=e.cards[r];t.shows>1&&(s=!0),t.status=c}s&&e.mistakes++,n.stars=this.calculateStars(e.mistakes)}),setTimeout(()=>{this.deleteStatusByIndexes(t)},this.delay)}deleteStatusByIndexes(t){this.setState(e=>{for(const s of t)delete e.cards[s].status})}calculateStars(t){return console.log("moves:",n.moves,"mistakes:",t),t<3?3:t<6?2:1}onDeckClick(t){t.target instanceof HTMLLIElement&&this.onSelectListElement(t.target)}onRestartClick(){this.restart()}}({deck:document.querySelector(".game .deck"),moves:document.querySelector(".game .moves"),stars:document.querySelector(".game .stars"),restart:document.querySelector(".game .restart")}),view:document.querySelector(".game-over"),moves:document.querySelector(".game-over .moves"),stars:document.querySelector(".game-over .stars"),restart:document.querySelector(".game-over .restart")})}]);